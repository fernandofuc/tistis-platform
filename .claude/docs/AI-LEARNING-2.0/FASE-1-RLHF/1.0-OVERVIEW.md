# ğŸ”„ FASE 1: RLHF (Reinforcement Learning from Human Feedback)

## Documento 1.0: VisiÃ³n General de RLHF

**VersiÃ³n:** 1.0.0
**Prioridad:** ğŸ”´ ALTA
**DuraciÃ³n estimada:** 8-9 semanas
**Dependencias:** Ninguna (puede iniciar inmediatamente)

---

## 1. RESUMEN EJECUTIVO

### 1.1 Objetivo

Implementar un sistema de **Reinforcement Learning from Human Feedback (RLHF)** que permita a los usuarios calificar las respuestas del AI (ğŸ‘/ğŸ‘), y usar ese feedback para mejorar automÃ¡ticamente la calidad de las respuestas.

### 1.2 Beneficios Esperados

| Beneficio | DescripciÃ³n | MÃ©trica Target |
|-----------|-------------|----------------|
| **Mejora continua** | El AI mejora sin intervenciÃ³n manual | +10% satisfacciÃ³n/trimestre |
| **DetecciÃ³n de problemas** | Identificar respuestas problemÃ¡ticas | <24hrs detecciÃ³n |
| **PersonalizaciÃ³n** | Ajustar comportamiento por vertical | Prompts por tenant |
| **Transparencia** | Usuarios ven que su feedback importa | >30% engagement |

### 1.3 Alcance de la Fase

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ALCANCE FASE 1: RLHF                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  âœ… EN ALCANCE:                                                         â”‚
â”‚  â”œâ”€â”€ Captura de feedback (ğŸ‘/ğŸ‘) en UI                                 â”‚
â”‚  â”œâ”€â”€ API para recibir feedback                                         â”‚
â”‚  â”œâ”€â”€ Almacenamiento en base de datos                                   â”‚
â”‚  â”œâ”€â”€ AgregaciÃ³n semanal de mÃ©tricas                                    â”‚
â”‚  â”œâ”€â”€ OptimizaciÃ³n semi-automÃ¡tica de prompts                           â”‚
â”‚  â”œâ”€â”€ Dashboard bÃ¡sico de feedback                                      â”‚
â”‚  â””â”€â”€ A/B testing de prompts                                            â”‚
â”‚                                                                         â”‚
â”‚  âŒ FUERA DE ALCANCE (fases posteriores):                               â”‚
â”‚  â”œâ”€â”€ Fine-tuning de modelo (FASE 5)                                    â”‚
â”‚  â”œâ”€â”€ Reentrenamiento automÃ¡tico                                        â”‚
â”‚  â”œâ”€â”€ Feedback de audio/voz                                             â”‚
â”‚  â””â”€â”€ Feedback multi-idioma                                             â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ARQUITECTURA DE RLHF

### 2.1 Diagrama de Componentes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ARQUITECTURA RLHF                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    1. FEEDBACK CAPTURE                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚           UI Component: FeedbackButtons                  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   ğŸ‘    â”‚  â”‚   ğŸ‘    â”‚  â”‚  "Â¿QuÃ© estuvo mal?"    â”‚  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚       â”‚            â”‚                    â”‚               â”‚    â”‚   â”‚
â”‚  â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                    â”‚                                     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                    â–¼                                     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚         POST /api/rlhf/feedback                         â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                            â”‚
â”‚                            â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    2. FEEDBACK SERVICE                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚   â”‚
â”‚  â”‚  â”‚   Validate    â”‚  â”‚   Enrich      â”‚  â”‚    Store      â”‚        â”‚   â”‚
â”‚  â”‚  â”‚   Input       â”‚â”€â”€â”‚   Context     â”‚â”€â”€â”‚    in DB      â”‚        â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                            â”‚
â”‚                            â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    3. ai_rlhf_feedback (DB)                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ id | tenant_id | message_id | rating | context | ...    â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                            â”‚
â”‚                            â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              4. FEEDBACK AGGREGATOR (CRON Weekly)                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚   â”‚
â”‚  â”‚  â”‚   Group by    â”‚  â”‚   Calculate   â”‚  â”‚    Detect     â”‚        â”‚   â”‚
â”‚  â”‚  â”‚ intent/agent  â”‚â”€â”€â”‚   Metrics     â”‚â”€â”€â”‚   Patterns    â”‚        â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                            â”‚
â”‚                            â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    5. ai_rlhf_aggregated (DB)                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ period | intent | satisfaction_rate | negative_patterns â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                            â”‚
â”‚                            â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              6. PROMPT OPTIMIZER                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚   â”‚
â”‚  â”‚  â”‚   Analyze     â”‚  â”‚   Generate    â”‚  â”‚   A/B Test    â”‚        â”‚   â”‚
â”‚  â”‚  â”‚   Problems    â”‚â”€â”€â”‚   New Prompt  â”‚â”€â”€â”‚   & Deploy    â”‚        â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                            â”‚
â”‚                            â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    7. ai_prompt_experiments (DB)                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ experiment | control_prompt | variant_prompt | results  â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Flujo de Datos

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FLUJO DE DATOS RLHF                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  TIEMPO REAL (cada interacciÃ³n):                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚                                                                         â”‚
â”‚  [User ve respuesta] â”€â”€â–º [User da ğŸ‘/ğŸ‘] â”€â”€â–º [API capture]             â”‚
â”‚         â”‚                       â”‚                  â”‚                    â”‚
â”‚         â”‚                       â”‚                  â–¼                    â”‚
â”‚         â”‚                       â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚         â”‚                       â”‚         â”‚ Enrich with:  â”‚             â”‚
â”‚         â”‚                       â”‚         â”‚ â€¢ intent      â”‚             â”‚
â”‚         â”‚                       â”‚         â”‚ â€¢ agent       â”‚             â”‚
â”‚         â”‚                       â”‚         â”‚ â€¢ confidence  â”‚             â”‚
â”‚         â”‚                       â”‚         â”‚ â€¢ response    â”‚             â”‚
â”‚         â”‚                       â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â”‚                       â”‚                  â”‚                    â”‚
â”‚         â”‚                       â”‚                  â–¼                    â”‚
â”‚         â”‚                       â”‚         [ai_rlhf_feedback]            â”‚
â”‚                                                                         â”‚
â”‚  BATCH SEMANAL (CRON):                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚
â”‚                                                                         â”‚
â”‚  [ai_rlhf_feedback] â”€â”€â–º [Aggregator]                                   â”‚
â”‚         â”‚                    â”‚                                          â”‚
â”‚         â”‚                    â–¼                                          â”‚
â”‚         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚         â”‚         â”‚ Para cada (tenant, intent):   â”‚                     â”‚
â”‚         â”‚         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                     â”‚
â”‚         â”‚         â”‚ SELECT                        â”‚                     â”‚
â”‚         â”‚         â”‚   COUNT(*) as total,          â”‚                     â”‚
â”‚         â”‚         â”‚   SUM(rating='up') as pos,    â”‚                     â”‚
â”‚         â”‚         â”‚   SUM(rating='down') as neg   â”‚                     â”‚
â”‚         â”‚         â”‚ GROUP BY tenant_id, intent    â”‚                     â”‚
â”‚         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚         â”‚                    â”‚                                          â”‚
â”‚         â”‚                    â–¼                                          â”‚
â”‚         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚         â”‚         â”‚ Detectar patrones negativos:  â”‚                     â”‚
â”‚         â”‚         â”‚ â€¢ Respuestas con >3 ğŸ‘        â”‚                     â”‚
â”‚         â”‚         â”‚ â€¢ Intents con <70% satisf.    â”‚                     â”‚
â”‚         â”‚         â”‚ â€¢ Keywords frecuentes en neg  â”‚                     â”‚
â”‚         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚         â”‚                    â”‚                                          â”‚
â”‚         â”‚                    â–¼                                          â”‚
â”‚         â”‚         [ai_rlhf_aggregated]                                  â”‚
â”‚                                                                         â”‚
â”‚  OPTIMIZACIÃ“N (cuando satisfaction < 80%):                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚
â”‚                                                                         â”‚
â”‚  [ai_rlhf_aggregated] â”€â”€â–º [Prompt Optimizer]                           â”‚
â”‚         â”‚                       â”‚                                       â”‚
â”‚         â”‚                       â–¼                                       â”‚
â”‚         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚         â”‚         â”‚ 1. Analizar negative_patterns â”‚                     â”‚
â”‚         â”‚         â”‚ 2. Identificar problema       â”‚                     â”‚
â”‚         â”‚         â”‚ 3. Proponer mejora al prompt  â”‚                     â”‚
â”‚         â”‚         â”‚ 4. Crear A/B experiment       â”‚                     â”‚
â”‚         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚         â”‚                       â”‚                                       â”‚
â”‚         â”‚                       â–¼                                       â”‚
â”‚         â”‚         [ai_prompt_experiments]                               â”‚
â”‚         â”‚                       â”‚                                       â”‚
â”‚         â”‚                       â–¼                                       â”‚
â”‚         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚         â”‚         â”‚ Traffic split:                â”‚                     â”‚
â”‚         â”‚         â”‚ â€¢ 50% â†’ control (actual)      â”‚                     â”‚
â”‚         â”‚         â”‚ â€¢ 50% â†’ variant (nuevo)       â”‚                     â”‚
â”‚         â”‚         â”‚                               â”‚                     â”‚
â”‚         â”‚         â”‚ Medir durante 1 semana        â”‚                     â”‚
â”‚         â”‚         â”‚ Si variant > control:         â”‚                     â”‚
â”‚         â”‚         â”‚   â†’ Promote variant           â”‚                     â”‚
â”‚         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. MICROFASES DE IMPLEMENTACIÃ“N

### 3.1 Resumen de Microfases

| # | Microfase | DescripciÃ³n | DuraciÃ³n | Dependencia |
|---|-----------|-------------|----------|-------------|
| 1.1 | Schema DB | Crear tablas y migraciones | 1 semana | - |
| 1.2 | API Feedback | Endpoint de captura | 1 semana | 1.1 |
| 1.3 | UI Components | Botones y modal de feedback | 1 semana | 1.2 |
| 1.4 | Aggregator | Service de agregaciÃ³n | 2 semanas | 1.2 |
| 1.5 | Prompt Optimizer | OptimizaciÃ³n automÃ¡tica | 2 semanas | 1.4 |
| 1.6 | Testing | Tests E2E y carga | 1 semana | 1.5 |

### 3.2 Diagrama de Gantt

```
Semana:    1    2    3    4    5    6    7    8    9
           â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
1.1 Schema â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                  â”‚
1.2 API          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                  â”‚    â”‚
1.3 UI           â”‚    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                  â”‚         â”‚
1.4 Aggregator   â”‚         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                  â”‚                   â”‚
1.5 Optimizer    â”‚                   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                  â”‚                             â”‚
1.6 Testing      â”‚                             â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                  â”‚                                  â”‚
           â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â–º Release
```

---

## 4. CRITERIOS DE Ã‰XITO

### 4.1 KPIs de la Fase

| KPI | Baseline | Target | MÃ©todo de MediciÃ³n |
|-----|----------|--------|-------------------|
| % respuestas con feedback | 0% | >30% | COUNT(feedback) / COUNT(responses) |
| SatisfacciÃ³n promedio | N/A | >80% | positive / total |
| Tiempo de detecciÃ³n de problema | N/A | <48hrs | Tiempo hasta alerta |
| Mejora post-optimizaciÃ³n | N/A | >5% | A/B test results |

### 4.2 Criterios de AceptaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CRITERIOS DE ACEPTACIÃ“N                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  âœ… FUNCIONALES:                                                        â”‚
â”‚  â”œâ”€â”€ [ ] Usuario puede dar ğŸ‘/ğŸ‘ a cualquier respuesta                 â”‚
â”‚  â”œâ”€â”€ [ ] Usuario puede agregar comentario opcional                     â”‚
â”‚  â”œâ”€â”€ [ ] Feedback se guarda correctamente en DB                        â”‚
â”‚  â”œâ”€â”€ [ ] AgregaciÃ³n semanal se ejecuta sin errores                     â”‚
â”‚  â”œâ”€â”€ [ ] Sistema detecta intents con satisfacciÃ³n <70%                 â”‚
â”‚  â”œâ”€â”€ [ ] A/B test se puede crear y ejecutar                            â”‚
â”‚  â””â”€â”€ [ ] Dashboard muestra mÃ©tricas de feedback                        â”‚
â”‚                                                                         â”‚
â”‚  âœ… NO FUNCIONALES:                                                     â”‚
â”‚  â”œâ”€â”€ [ ] Latencia de API <200ms p99                                    â”‚
â”‚  â”œâ”€â”€ [ ] Sin impacto en rendimiento de chat                            â”‚
â”‚  â”œâ”€â”€ [ ] Datos aislados por tenant                                     â”‚
â”‚  â”œâ”€â”€ [ ] Rate limiting: 10 feedback/lead/hora                          â”‚
â”‚  â””â”€â”€ [ ] Tests con >80% cobertura                                      â”‚
â”‚                                                                         â”‚
â”‚  âœ… DOCUMENTACIÃ“N:                                                      â”‚
â”‚  â”œâ”€â”€ [ ] API documentada en OpenAPI                                    â”‚
â”‚  â”œâ”€â”€ [ ] Runbook de operaciones                                        â”‚
â”‚  â””â”€â”€ [ ] GuÃ­a de troubleshooting                                       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. RIESGOS Y MITIGACIONES

### 5.1 Matriz de Riesgos

| Riesgo | Probabilidad | Impacto | MitigaciÃ³n |
|--------|--------------|---------|------------|
| Bajo engagement de feedback | Alta | Medio | UI prominente, gamification |
| Feedback spam/abuso | Media | Alto | Rate limiting, validaciÃ³n |
| Falsos positivos en optimizaciÃ³n | Media | Alto | A/B testing obligatorio |
| Overhead de storage | Baja | Bajo | TTL de 90 dÃ­as en raw feedback |
| Latencia en captura | Baja | Medio | Async processing |

### 5.2 Plan de Contingencia

```yaml
Si engagement < 10% despuÃ©s de 2 semanas:
  - Agregar incentivos (badge, gamification)
  - Mostrar impacto del feedback al usuario
  - Simplificar UI (solo ğŸ‘/ğŸ‘, sin modal)

Si spam detectado:
  - Activar rate limiting estricto
  - Agregar CAPTCHA para feedback negativo
  - Bloquear leads problemÃ¡ticos

Si A/B test no muestra mejora:
  - Mantener prompt actual
  - Analizar manualmente los negativos
  - Escalar a revisiÃ³n humana
```

---

## 6. DEPENDENCIAS TÃ‰CNICAS

### 6.1 Dependencias de Infraestructura

```yaml
Existentes (no cambios):
  - Supabase PostgreSQL
  - Vercel Serverless
  - Next.js App Router

Nuevas:
  - CRON job semanal (Vercel Cron o similar)
  - Posible: Redis para rate limiting (opcional)
```

### 6.2 Dependencias de CÃ³digo

```json
{
  "existentes": {
    "@supabase/supabase-js": "ya instalado",
    "next": "ya instalado",
    "react": "ya instalado"
  },
  "nuevas": {
    "ninguna": "No se requieren dependencias nuevas"
  }
}
```

---

## 7. ARCHIVOS A CREAR/MODIFICAR

### 7.1 Nuevos Archivos

```
src/features/ai/
â”œâ”€â”€ services/
â”‚   â””â”€â”€ rlhf/
â”‚       â”œâ”€â”€ feedback-capture.service.ts    # Captura y validaciÃ³n
â”‚       â”œâ”€â”€ feedback-aggregator.service.ts # AgregaciÃ³n semanal
â”‚       â””â”€â”€ prompt-optimizer.service.ts    # OptimizaciÃ³n de prompts
â”œâ”€â”€ types/
â”‚   â””â”€â”€ rlhf.types.ts                      # Tipos TypeScript

app/api/
â”œâ”€â”€ rlhf/
â”‚   â”œâ”€â”€ feedback/
â”‚   â”‚   â””â”€â”€ route.ts                       # POST /api/rlhf/feedback
â”‚   â”œâ”€â”€ metrics/
â”‚   â”‚   â””â”€â”€ route.ts                       # GET /api/rlhf/metrics
â”‚   â””â”€â”€ experiments/
â”‚       â””â”€â”€ route.ts                       # CRUD experimentos

src/components/
â””â”€â”€ feedback/
    â”œâ”€â”€ FeedbackButtons.tsx                # ğŸ‘/ğŸ‘ buttons
    â”œâ”€â”€ FeedbackModal.tsx                  # Modal de detalle
    â””â”€â”€ FeedbackStats.tsx                  # Mini dashboard

supabase/migrations/
â””â”€â”€ 200_AI_LEARNING_RLHF.sql              # Schema de DB
```

### 7.2 Archivos a Modificar

```
Archivos existentes a modificar:
â”œâ”€â”€ src/features/ai/services/langgraph-ai.service.ts
â”‚   â””â”€â”€ Agregar message_id al response para tracking
â”‚
â”œâ”€â”€ src/components/inbox/MessageBubble.tsx (o similar)
â”‚   â””â”€â”€ Incluir FeedbackButtons en respuestas del AI
â”‚
â””â”€â”€ app/(dashboard)/dashboard/business-ia/page.tsx
    â””â”€â”€ Agregar secciÃ³n de feedback metrics
```

---

## 8. PRÃ“XIMOS PASOS

### 8.1 Checklist Pre-ImplementaciÃ³n

- [ ] Revisar y aprobar este documento
- [ ] Asignar desarrollador(es) responsable(s)
- [ ] Configurar ambiente de staging
- [ ] Crear branch de feature: `feature/ai-learning-rlhf`
- [ ] Revisar esquema de DB con equipo

### 8.2 Orden de ImplementaciÃ³n

1. **Comenzar con:** [1.1-SCHEMA-DB.md](./1.1-SCHEMA-DB.md)
2. **Seguir con:** [1.2-API-FEEDBACK.md](./1.2-API-FEEDBACK.md)
3. **Continuar:** SegÃºn orden de microfases

---

**Documentos relacionados:**
- [1.1-SCHEMA-DB.md](./1.1-SCHEMA-DB.md) - Esquema de base de datos
- [1.2-API-FEEDBACK.md](./1.2-API-FEEDBACK.md) - API de captura
- [1.3-UI-COMPONENTS.md](./1.3-UI-COMPONENTS.md) - Componentes UI
- [1.4-AGGREGATOR.md](./1.4-AGGREGATOR.md) - Agregador
- [1.5-PROMPT-OPTIMIZER.md](./1.5-PROMPT-OPTIMIZER.md) - Optimizador
- [1.6-TESTING.md](./1.6-TESTING.md) - Plan de testing
